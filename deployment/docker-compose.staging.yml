version: '3.8'

services:
  devpad-staging:
    image: ghcr.io/f0rbit/devpad:staging
    container_name: devpad-staging
    ports:
      - "17365:17365"
    environment:
      NODE_ENV: staging
      TEST_MODE: ${TEST_MODE:-disabled}
      PORT: 17365
      DATABASE_FILE: /app/data/devpad-staging.db
      STATIC_FILES_PATH: ./apps/main/dist/client
      CORS_ORIGINS: https://staging.devpad.tools
      FRONTEND_URL: https://staging.devpad.tools
      MODE: production
      PUBLIC_API_SERVER_URL: https://staging.devpad.tools/api/v0
      GITHUB_CLIENT_SECRET:
      GITHUB_CLIENT_ID:
    volumes:
      - devpad_staging_data:/app/data
      - /var/log/devpad/staging:/app/logs
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:17365/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s

volumes:
  devpad_staging_data:
    driver: local
    driver_opts:
      type: none
      o: bind
      device: /var/data/devpad-staging
