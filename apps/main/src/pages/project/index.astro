---
import GithubLogin from "@/components/solid/GithubLogin";
import { ProjectCardGrid } from "../../components/solid/ProjectCardGrid";
import PageLayout from "@/layouts/PageLayout.astro";
import { getServerApiClient, rethrow } from "@/utils/api-client";
import { Project } from "@devpad/schema";

let user = Astro.locals.user;

let projects: Project[] = [];

if (user) {
	try {
		const api_client = getServerApiClient(Astro.locals);
		const result = await api_client.projects.list();
		if (!result.ok) return rethrow(result.error);
		projects = result.value;
	} catch (error) {
		// the error here is that the user is not logged in/authenticated.
		// which we can safely ignore since this is optional.
		user = null;
	}
}

//
const keywords = [
	// One-word keywords
	"projects",
	"management",
	"github",
	"tasks",
	"milestones",

	// Two-word keywords
	"project management",
	"github integration",
	"task tracking",
	"code scanning",
	"project updates",
	"project visibility",
	"task automation",
	"project milestones",
	"project goals",
	"development progress",
	"project links",

	// Three-word keywords
	"github project management",
	"codebase task tracking",
	"project milestone tracking",
	"project visibility tools",
	"development project management",
];
---

<PageLayout
  title="Projects - devpad"
  description="Manage your development projects effortlessly with devpad. Track progress, link GitHub repositories, scan codebases for tasks, and centralize project visibility, milestones, and updates—all in one place."
  keywords={keywords}
  canonical="https://devpad.tools/project"
>
  {
    user && (
      <main>
        <section>
          <div class="flex-row" style="justify-content: space-between; margin-bottom: 1rem;">
            <h3>projects</h3>
            <a href="/project/create">+ add</a>
          </div>
          <ProjectCardGrid projects={projects} client:load />
        </section>
      </main>
    )
}
{!user && (
  <main>
    <section class="landing-hero">
      <div class="dot-grid"></div>
      <h1 style="font-size: 2.5rem; font-weight: 600; margin: 0;">organize your projects</h1>
      <p class="text-lg text-muted hero-description">
        keep all your development projects in one place. link GitHub repositories, track milestones, set version numbers, and manage visibility — all from a single dashboard.
      </p>
      <GithubLogin client:load />
    </section>

    <section class="landing-section">
      <h2 class="section-title text-xl font-bold">features</h2>
      <div class="grid grid-2">
        <div class="card card-flat">
          <div class="row" style="gap: var(--space-sm); margin-bottom: var(--space-sm);">
            <span class="card-icon">
              <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M15 22v-4a4.8 4.8 0 0 0-1-3.5c3 0 6-2 6-5.5.08-1.25-.27-2.48-1-3.5.28-1.15.28-2.35 0-3.5 0 0-1 0-3 1.5-2.64-.5-5.36-.5-8 0C6 2 5 2 5 2c-.3 1.15-.3 2.35 0 3.5A5.403 5.403 0 0 0 4 9c0 3.5 3 5.5 6 5.5-.39.49-.68 1.05-.85 1.65-.17.6-.22 1.23-.15 1.85v4"/><path d="M9 18c-4.51 2-5-2-7-2"/></svg>
            </span>
            <h3 class="card-title">GitHub Integration</h3>
          </div>
          <p class="card-description">link repositories to projects and scan for TODO comments automatically. devpad detects changes on every push and creates tasks from your codebase.</p>
        </div>
        <div class="card card-flat">
          <div class="row" style="gap: var(--space-sm); margin-bottom: var(--space-sm);">
            <span class="card-icon">
              <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M4 15s1-1 4-1 5 2 8 2 4-1 4-1V3s-1 1-4 1-5-2-8-2-4 1-4 1z"/><line x1="4" x2="4" y1="22" y2="15"/></svg>
            </span>
            <h3 class="card-title">Milestones & Goals</h3>
          </div>
          <p class="card-description">break projects into milestones with target versions and deadlines. attach goals to milestones to track granular progress toward each release.</p>
        </div>
        <div class="card card-flat">
          <div class="row" style="gap: var(--space-sm); margin-bottom: var(--space-sm);">
            <span class="card-icon">
              <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12V7H5a2 2 0 0 1 0-4h14v4"/><path d="M3 5v14a2 2 0 0 0 2 2h16v-5"/><path d="M18 12a2 2 0 0 0 0 4h4v-4Z"/></svg>
            </span>
            <h3 class="card-title">API Export</h3>
          </div>
          <p class="card-description">access all project data through the REST API. build portfolio integrations, custom dashboards, or pipe data into other tools with bearer token auth.</p>
        </div>
        <div class="card card-flat">
          <div class="row" style="gap: var(--space-sm); margin-bottom: var(--space-sm);">
            <span class="card-icon">
              <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z"/></svg>
            </span>
            <h3 class="card-title">Automatic Versioning</h3>
          </div>
          <p class="card-description">set current versions on projects and track status from development through to release. visibility controls let you show or hide projects as needed.</p>
        </div>
      </div>
    </section>

    <section class="landing-section">
      <h2 class="section-title text-xl font-bold">your projects at a glance</h2>
      <div class="grid grid-3">
        <div class="card flex-col" style="gap: 3px;">
          <div><span class="task-title">game-engine</span></div>
          <p class="task-summary">a 2D engine built with WebGL</p>
          <div style="height: 100%;"></div>
          <div class="flex-col" style="font-size: small; gap: 6px;">
            <span class="flex-row">
              <span style="color: var(--fg-faint);">2 days ago</span>
              <span style="color: color-mix(in srgb, var(--fg-muted) 70%, green); font-weight: 500; margin-left: auto;">Live</span>
            </span>
          </div>
        </div>
        <div class="card flex-col" style="gap: 3px;">
          <div><span class="task-title">blog-theme</span></div>
          <p class="task-summary">custom astro theme for technical writing</p>
          <div style="height: 100%;"></div>
          <div class="flex-col" style="font-size: small; gap: 6px;">
            <span class="flex-row">
              <span style="color: var(--fg-faint);">5 days ago</span>
              <span style="color: var(--text-link); font-weight: 500; margin-left: auto;">Development</span>
            </span>
          </div>
        </div>
        <div class="card flex-col" style="gap: 3px;">
          <div><span class="task-title">cli-tool</span></div>
          <p class="task-summary">command-line interface for devpad</p>
          <div style="height: 100%;"></div>
          <div class="flex-col" style="font-size: small; gap: 6px;">
            <span class="flex-row">
              <span style="color: var(--fg-faint);">2 weeks ago</span>
              <span style="color: var(--fg-muted); font-weight: 500; margin-left: auto;">Paused</span>
            </span>
          </div>
        </div>
      </div>
    </section>

    <section class="landing-section stack" style="text-align: center; align-items: center;">
      <h2 class="text-xl font-bold">ready to organize?</h2>
      <p class="text-muted">sign in with GitHub to import your first project.</p>
      <GithubLogin client:load />
    </section>
  </main>
)}
</PageLayout>

<style>
	.landing-hero {
		position: relative;
		text-align: center;
		max-width: 800px;
		margin: 0 auto;
		padding: 6rem var(--space-lg);
		display: flex;
		flex-direction: column;
		align-items: center;
		gap: var(--space-md);
	}

	.dot-grid {
		position: absolute;
		inset: 0;
		overflow: hidden;
		pointer-events: none;
		mask-image: radial-gradient(ellipse 70% 50% at 50% 50%, black 20%, transparent 70%);
		-webkit-mask-image: radial-gradient(ellipse 70% 50% at 50% 50%, black 20%, transparent 70%);
	}

	.dot-grid::before {
		content: "";
		position: absolute;
		inset: -50%;
		width: 200%;
		height: 200%;
		background-image: radial-gradient(circle at center, var(--border) 1.5px, transparent 1.5px);
		background-size: 32px 32px;
		opacity: 0.5;
		animation: dot-wave 25s linear infinite;
	}

	@keyframes dot-wave {
		0% { transform: translate(0, 0); }
		100% { transform: translate(32px, 32px); }
	}

	.landing-section {
		max-width: 1000px;
		margin: 0 auto;
		padding: calc(var(--space-xl) * 1.5) var(--space-md);
		width: 100%;
		box-sizing: border-box;
		display: flex;
		flex-direction: column;
		gap: var(--space-lg);
	}

	.section-title {
		text-align: center;
		margin-bottom: 0;
	}

	.hero-description {
		max-width: 500px;
		margin: 0;
	}

	@media (max-width: 768px) {
		.landing-hero {
			padding: 4rem var(--space-md);
		}
	}

	@media (max-width: 480px) {
		.landing-hero {
			padding: 3rem var(--space-sm);
		}
	}
</style>
