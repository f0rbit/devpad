---
import Dashboard from "../../components/solid/Dashboard/Dashboard";
import AppLayout from "../../layouts/AppLayout.astro";
import { type ProfileTimelineResponse } from "../../utils/types";
import { getServerApiClient } from "@devpad/core/ui/api-client";

const profileSlug = Astro.url.searchParams.get("profile");

let initialTimeline: ProfileTimelineResponse | null = null;

if (profileSlug && Astro.locals.user) {
	try {
		const client = getServerApiClient(Astro.locals);
		const result = await client.media.profiles.timeline(profileSlug);
		if (result.ok) {
			initialTimeline = result.value as ProfileTimelineResponse;
		}
	} catch {
		// SSR fetch failed, component will fetch client-side
	}
}
---

<AppLayout 
  title="Dashboard | Media Timeline"
  description="Your activity overview and insights across connected platforms."
  noindex={true}
>
  <section>
    <h1 class="page-title">Dashboard</h1>
    <p class="description">Your activity overview and insights.</p>
  </section>
  <Dashboard 
    client:load 
    profileSlug={profileSlug} 
    initialTimeline={initialTimeline}
  />
</AppLayout>
