---
import { Button } from "@f0rbit/ui";
import HowItWorks from "@/components/landing/HowItWorks";
import BaseLayout from "@/layouts/base-layout.astro";
import CalendarCheck from "lucide-astro/CalendarCheck";
import FileText from "lucide-astro/FileText";
import Github from "lucide-astro/Github";
import History from "lucide-astro/History";
import RefreshCw from "lucide-astro/RefreshCw";
import Sparkles from "lucide-astro/Sparkles";
import Tag from "lucide-astro/Tag";

const isAuthenticated = !!Astro.locals.user;
---

<BaseLayout title="Blog - devpad">
  <div class="landing">
    <nav class="landing-nav row row-between">
      <a href="/" class="font-medium" style="text-decoration: none; color: var(--fg); font-size: 1.25rem;">blog</a>
      {isAuthenticated ? (
        <a href="/posts" style="text-decoration: none;"><Button variant="primary">dashboard</Button></a>
      ) : (
        <a href="/api/auth/login" style="text-decoration: none;"><Button variant="primary">login</Button></a>
      )}
    </nav>

    <section class="landing-hero">
      <h1 style="font-size: clamp(2rem, 5vw, 2.75rem); font-weight: 600; margin: 0;">blogging. for developers.</h1>
      <p class="text-muted" style="max-width: 520px; margin: 0; text-align: center; line-height: 1.6;">
        a blog platform built for devpad. link posts to projects, write in markdown, and publish with version control.
      </p>
      {isAuthenticated ? (
        <a href="/posts" style="text-decoration: none;">
          <Button variant="primary" size="lg">open dashboard</Button>
        </a>
      ) : (
        <a href="/api/auth/login" style="text-decoration: none;">
          <Button variant="primary" size="lg">get started</Button>
        </a>
      )}
      <div class="hero-mockup">
        <div class="mockup-window">
          <div class="mockup-header">
            <span class="mockup-dot"></span>
            <span class="mockup-dot"></span>
            <span class="mockup-dot"></span>
          </div>
          <div class="mockup-content">
            <div class="mockup-editor">
              <code class="typing-text"></code><span class="typing-cursor">|</span>
            </div>
            <div class="mockup-divider"></div>
            <div class="mockup-preview">
              <h1 class="preview-h1">hello world</h1>
              <p class="preview-p">write your thoughts in <strong>markdown</strong>.</p>
            </div>
          </div>
        </div>
      </div>
    </section>

    <section class="landing-section">
      <h2 class="section-title text-xl font-bold">features</h2>
      <div class="grid grid-2">
        <div class="card card-flat">
          <div class="row" style="gap: var(--space-sm); margin-bottom: var(--space-sm);">
            <FileText size={20} />
            <h3 class="card-title">markdown editor</h3>
          </div>
          <p class="card-description">write posts in markdown with a split-pane live preview. supports syntax highlighting, tables, and code blocks out of the box.</p>
        </div>
        <div class="card card-flat">
          <div class="row" style="gap: var(--space-sm); margin-bottom: var(--space-sm);">
            <History size={20} />
            <h3 class="card-title">version history</h3>
          </div>
          <p class="card-description">every save creates an immutable version. browse history, compare changes, and restore any previous state with one click.</p>
        </div>
        <div class="card card-flat">
          <div class="row" style="gap: var(--space-sm); margin-bottom: var(--space-sm);">
            <Sparkles size={20} />
            <h3 class="card-title">project linking</h3>
          </div>
          <p class="card-description">connect posts to your devpad projects. write devlogs, release notes, or tutorials tied directly to what you're building.</p>
        </div>
        <div class="card card-flat">
          <div class="row" style="gap: var(--space-sm); margin-bottom: var(--space-sm);">
            <CalendarCheck size={20} />
            <h3 class="card-title">scheduled publishing</h3>
          </div>
          <p class="card-description">set a publish date and time. posts automatically go live on schedule â€” no need to be at your desk.</p>
        </div>
        <div class="card card-flat">
          <div class="row" style="gap: var(--space-sm); margin-bottom: var(--space-sm);">
            <Tag size={20} />
            <h3 class="card-title">categories & tags</h3>
          </div>
          <p class="card-description">organize posts with nested categories and flexible tags. filter and find content across your entire blog.</p>
        </div>
        <div class="card card-flat">
          <div class="row" style="gap: var(--space-sm); margin-bottom: var(--space-sm);">
            <RefreshCw size={20} />
            <h3 class="card-title">api access</h3>
          </div>
          <p class="card-description">generate API tokens to read your published posts. build custom frontends or integrate with static site generators.</p>
        </div>
      </div>
    </section>

    <section class="landing-section">
      <h2 class="section-title text-xl font-bold">how it works</h2>
      <HowItWorks client:load />
    </section>

    <section class="landing-section">
      <h2 class="section-title text-xl font-bold">build your own frontend</h2>
      <div class="grid grid-3">
        <div class="card card-flat api-step">
          <div class="api-step__code">
            <code><span class="terminal-prompt">&gt;</span> bun add @devpad/blog</code>
          </div>
          <div class="api-step__label">install</div>
        </div>
        <div class="card card-flat api-step">
          <div class="api-step__code">
            <pre><code>const posts = await devpad
    .blog
    .getByProject('my-app')</code></pre>
          </div>
          <div class="api-step__label">fetch</div>
        </div>
        <div class="card card-flat api-step">
          <div class="api-step__code api-step__code--render">
            <div class="render-preview">
              <div class="render-line render-line--title"></div>
              <div class="render-line render-line--short"></div>
              <div class="render-line render-line--medium"></div>
              <div class="render-line render-line--long"></div>
            </div>
          </div>
          <div class="api-step__label">render</div>
        </div>
      </div>
      <p class="text-muted" style="text-align: center;">full typescript support. works everywhere.</p>
    </section>

    <section class="landing-section">
      <h2 class="section-title text-xl font-bold">recent posts</h2>
      <div class="grid grid-2">
        <div class="card card-flat flex-col" style="gap: 3px;">
          <div><span class="task-title">building a game engine from scratch</span></div>
          <p class="card-description">a deep dive into WebGL rendering pipelines and entity component systems</p>
          <div style="margin-top: var(--space-sm); font-size: small; display: flex; gap: var(--space-sm); color: var(--fg-faint);">
            <span>jan 15, 2026</span>
            <span style="margin-left: auto;">development</span>
          </div>
        </div>
        <div class="card card-flat flex-col" style="gap: 3px;">
          <div><span class="task-title">API-first project management</span></div>
          <p class="card-description">why every feature in devpad is an API call and how to build your own integrations</p>
          <div style="margin-top: var(--space-sm); font-size: small; display: flex; gap: var(--space-sm); color: var(--fg-faint);">
            <span>jan 28, 2026</span>
            <span style="margin-left: auto;">tutorial</span>
          </div>
        </div>
      </div>
    </section>

    <section class="landing-section stack" style="text-align: center; align-items: center;">
      <h2 class="text-xl font-bold">ready to start writing?</h2>
      <p class="text-muted">sign in to begin.</p>
      {isAuthenticated ? (
        <a href="/posts" style="text-decoration: none;">
          <Button variant="primary" size="lg">open dashboard</Button>
        </a>
      ) : (
        <a href="/api/auth/login" style="text-decoration: none;">
          <Button variant="primary" size="lg"><Github size={18} />login with github</Button>
        </a>
      )}
    </section>

    <footer class="landing-footer text-sm text-faint">
      blog.devpad.tools &middot; <a href="https://devpad.tools">devpad.tools</a>
    </footer>
  </div>
</BaseLayout>

<style>
  :global(body) {
    width: 100%;
    padding: 0;
    margin: 0;
  }

  .landing {
    min-height: 100vh;
    display: flex;
    flex-direction: column;
    overflow-x: hidden;
  }

  .landing-nav {
    max-width: 1000px;
    margin: 0 auto;
    padding: var(--space-md);
    width: 100%;
    box-sizing: border-box;
  }

  .landing-hero {
    text-align: center;
    max-width: 800px;
    margin: 0 auto;
    padding: 6rem var(--space-lg) 4rem;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: var(--space-md);
  }

  .hero-mockup {
    width: 100%;
    max-width: 600px;
    margin-top: var(--space-md);
  }

  .landing-section {
    max-width: 1000px;
    margin: 0 auto;
    padding: calc(var(--space-xl) * 1.5) var(--space-md);
    width: 100%;
    box-sizing: border-box;
    display: flex;
    flex-direction: column;
    gap: var(--space-lg);
  }

  .section-title {
    text-align: center;
    margin-bottom: 0;
  }

  .landing-footer {
    max-width: 1000px;
    margin: 0 auto;
    padding: var(--space-xl) var(--space-md);
    text-align: center;
    margin-top: auto;
  }

  .landing-footer a {
    color: var(--fg-faint);
    text-decoration: none;
  }

  .landing-footer a:hover {
    color: var(--fg);
  }

  .mockup-window {
    background: var(--bg-alt);
    border: 1px solid var(--border);
    border-radius: 8px;
    overflow: hidden;
    box-shadow: 0 4px 24px rgba(0, 0, 0, 0.15);
  }

  .mockup-header {
    display: flex;
    gap: 6px;
    padding: 12px 14px;
    background: var(--bg);
    border-bottom: 1px solid var(--border);
  }

  .mockup-dot {
    width: 12px;
    height: 12px;
    border-radius: 50%;
    background: var(--border);
  }

  .mockup-dot:nth-child(1) { background: #ff5f57; }
  .mockup-dot:nth-child(2) { background: #febc2e; }
  .mockup-dot:nth-child(3) { background: #28c840; }

  .mockup-content {
    display: grid;
    grid-template-columns: 1fr 1px 1fr;
    min-height: 180px;
  }

  .mockup-editor {
    padding: 1rem;
    font-family: "SF Mono", "Fira Code", "Consolas", monospace;
    font-size: 0.8125rem;
    line-height: 1.6;
    color: var(--fg-faint);
    white-space: pre-wrap;
    overflow: hidden;
  }

  .typing-text { color: var(--fg); }

  .typing-cursor {
    color: var(--fg);
    animation: blink 1s step-end infinite;
  }

  @keyframes blink {
    0%, 100% { opacity: 1; }
    50% { opacity: 0; }
  }

  .mockup-divider { background: var(--border); }

  .mockup-preview {
    padding: 1rem;
    color: var(--fg);
    opacity: 0;
    transition: opacity 0.3s ease;
  }

  .mockup-preview.visible { opacity: 1; }

  .preview-h1 {
    font-size: 1.25rem;
    font-weight: 700;
    margin-bottom: 0.75rem;
    color: var(--fg);
  }

  .preview-p {
    font-size: 0.875rem;
    line-height: 1.6;
    color: var(--fg-faint);
  }

  .preview-p strong {
    color: var(--fg);
    font-weight: 600;
  }

  .api-step {
    padding: 0;
    overflow: hidden;
    display: flex;
    flex-direction: column;
  }

  .api-step__code {
    flex: 1;
    padding: 1.5rem;
    display: flex;
    align-items: center;
    justify-content: center;
    min-height: 120px;
    background: oklch(0.18 0.01 285);
  }

  .api-step__code code {
    font-family: "SF Mono", "Fira Code", "Consolas", monospace;
    font-size: 0.875rem;
    color: var(--fg);
  }

  .api-step__code pre {
    margin: 0;
    text-align: left;
  }

  .api-step__code pre code { line-height: 1.5; }

  .api-step__code--render { padding: 1.5rem 2rem; }

  .terminal-prompt {
    color: var(--fg-faint);
    margin-right: 0.5rem;
  }

  .render-preview {
    width: 100%;
    max-width: 140px;
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
    padding: 0.75rem;
    border: 1px solid var(--border);
    border-radius: 4px;
    background: var(--bg);
  }

  .render-line {
    height: 8px;
    background: var(--border);
    border-radius: 2px;
  }

  .render-line--title {
    width: 70%;
    height: 10px;
    margin-bottom: 0.25rem;
  }

  .render-line--short { width: 40%; }
  .render-line--medium { width: 60%; }
  .render-line--long { width: 85%; }

  .api-step__label {
    padding: 0.75rem;
    font-size: 0.875rem;
    font-weight: 500;
    color: var(--fg-faint);
    border-top: 1px solid var(--border);
    background: var(--bg);
  }

  @media (max-width: 768px) {
    .landing-hero {
      padding: 4rem var(--space-md) 3rem;
    }

    .hero-mockup {
      max-width: 500px;
    }

    .mockup-content {
      min-height: 160px;
    }
  }

  @media (max-width: 480px) {
    .landing-hero {
      padding: 3rem var(--space-sm) 2rem;
    }

    .hero-mockup {
      max-width: 100%;
    }

    .mockup-content {
      grid-template-columns: 1fr;
      min-height: auto;
    }

    .mockup-divider { height: 1px; }

    .mockup-editor, .mockup-preview {
      padding: 0.875rem;
    }

    .mockup-editor {
      font-size: 0.75rem;
      min-height: 80px;
    }

    .preview-h1 { font-size: 1.125rem; }
    .preview-p { font-size: 0.8125rem; }

    .api-step__code {
      min-height: 80px;
      padding: 1rem;
    }

    .api-step__code code { font-size: 0.8125rem; }
    .api-step__code--render { padding: 1rem 1.5rem; }
    .render-preview { max-width: 120px; }

    .api-step__label {
      padding: 0.625rem;
      font-size: 0.8125rem;
    }
  }
</style>

<script>
  const TYPING_TEXT = `# hello world

write your thoughts in **markdown**.`;

  const TYPING_SPEED = 50;
  const INITIAL_DELAY = 500;
  const RESTART_DELAY = 3000;

  const typeText = (element: Element, text: string, onComplete: () => void) => {
    let index = 0;
    
    const tick = () => {
      if (index >= text.length) {
        onComplete();
        return;
      }
      element.textContent = text.slice(0, index + 1);
      index++;
      setTimeout(tick, TYPING_SPEED);
    };
    
    tick();
  };

  const init = () => {
    const textElement = document.querySelector('.typing-text');
    const previewElement = document.querySelector('.mockup-preview');
    
    if (!textElement || !previewElement) return;

    const runAnimation = () => {
      textElement.textContent = '';
      previewElement.classList.remove('visible');
      
      setTimeout(() => {
        typeText(textElement, TYPING_TEXT, () => {
          previewElement.classList.add('visible');
          setTimeout(runAnimation, RESTART_DELAY);
        });
      }, INITIAL_DELAY);
    };

    runAnimation();
  };

  document.addEventListener('DOMContentLoaded', init);
</script>
