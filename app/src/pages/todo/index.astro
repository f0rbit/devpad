---
import PageLayout from "../../layouts/PageLayout.astro";
import { getUserProjectMap } from "../../server/projects";
import { getUserTasks } from "../../server/tasks";
import { TaskSorter } from "../../components/solid/TaskSorter";
import Tag from "lucide-solid/icons/tag";
import { getActiveUserTags } from "../../server/tags";
import Plus from "lucide-solid/icons/plus";
import GithubLogin from "../../components/solid/GithubLogin";

const user = Astro.locals.user;

const project_map = user ? await getUserProjectMap(user!.id) : {};
const tasks = user ?  await getUserTasks(user!.id) : [];

const tags = user ? await getActiveUserTags(user!.id) : [];

const keywords = [
  // One-word keywords
  "tasks",
  "todo",
  "tracking",
  "priorities",
  "automation",

  // Two-word keywords
  "task management",
  "todo tracking",
  "code scanning",
  "task priorities",
  "due dates",
  "task automation",
  "task filtering",
  "todo comments",
  "task updates",
  "task editor",
  "task organization",
  "project tasks",
  "task integration",
  "task visibility",
  "task progress",

  // Three-word keywords
  "todo comment scanning",
  "task priority management",
  "codebase task tracking",
  "task organization tools",
  "task management system"
];
---

<PageLayout title="Tasks - devpad" description="Streamline your task management with devpad. Track, organize, and prioritize tasks effortlessly. Automatically scan your codebase for TODO comments, assign priorities, set due dates, and integrate seamlessly with your projects." keywords={keywords} canonical="https://devpad.tools/todo">
  <main>
{user ?
    <section>
      <div class="flex-row">
        <h3>upcoming tasks</h3>
        <a href="/todo/new" style="font-size: small;" class="flex-row">
          <Plus />
          new task
        </a>
        <a
          href="/todo/tags"
          style="margin-left: auto; font-size: small;"
          class="flex-row"
        >
          <Tag />
          tags
        </a>
      </div>
      <TaskSorter
        client:load
        tasks={tasks}
        project_map={project_map}
        defaultOption={"upcoming"}
        tags={tags}
        user_id={user.id}
        defaultView={user.task_view}
      />
</section>
  : <>
    <p>you must be logged in.</p>
    <GithubLogin client:load />
  </>}
  </main>
</PageLayout>
