---
import PageLayout from '../../layouts/PageLayout.astro';
import { getUserProjects } from '../../server/projects';
import { getUserTasks } from '../../server/tasks';

const user = Astro.locals.user;
const projects = user ? await getUserProjects(user.id) : [];
const codebases = projects.filter((p) => p.visibility != "DELETED").map((p) => p.project_id);
const tasks = user ? await getUserTasks(user.id) : [];
---

<PageLayout title="Welcome to Astro.">
	<main>
			<h1>todo tracker</h1>
		<section>
			<h2>codebases</h2>
			{codebases.map((c) => <a href=`/todo/${c}`>{c}</a>)}
		</section>
		<section>
			<h2>upcoming tasks</h2>
			<ul>
			{tasks.map((t) => <li>
				<pre>{JSON.stringify(t, null, 2)}</pre>
			</li>)}
			</ul>
		</section>
	</main>
</PageLayout>


<style>
section {
	display: flex;
	flex-direction: column;
}
</style>
