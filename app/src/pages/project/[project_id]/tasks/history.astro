---
/** @idea scan history should be able to be inspected to see breakdown of changes and what we accepted/rejected */
import { getProject } from "../../../../server/projects.ts";
import PageLayout from "../../../../layouts/PageLayout.astro";
import ProjectTasksLayout from "../../../../layouts/ProjectTasksLayout.astro";
import { getProjectHistory } from "../../../../server/action";
import HistoryTimeline from "../../../../components/solid/HistoryTimeline";

const { project_id } = Astro.params;
if (!project_id)
  return new Response(null, { status: 404, statusText: "Project not found" });
const user = Astro.locals.user;
if (!user)
  return new Response(null, { status: 401, statusText: "Unauthorized" });

const { project: found_project, error } =
  (await getProject(user?.id ?? null, project_id)) ?? null;
if (error) return new Response(null, { status: 500, statusText: error });
if (!found_project)
  return new Response(null, { status: 404, statusText: "Project not found" });

const project_uuid = found_project.id;

// get all updates as well
const history = await getProjectHistory(project_uuid);

---

<PageLayout title={`Codebase - ${project_id} - Update`}>
  <ProjectTasksLayout project_id={project_id}>
    <h3>Updates</h3>
    <HistoryTimeline actions={history} client:load />
    </ul>
  </ProjectTasksLayout>
</PageLayout>

