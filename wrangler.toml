name = "devpad-unified"
main = "dist/_worker.js"
compatibility_date = "2024-12-01"
compatibility_flags = ["nodejs_compat"]

[assets]
directory = "dist"

routes = [
  { pattern = "devpad.tools", custom_domain = true },
  { pattern = "blog.devpad.tools", custom_domain = true },
  { pattern = "media.devpad.tools", custom_domain = true },
]

[triggers]
crons = ["*/5 * * * *"]

[vars]
ENVIRONMENT = "production"
API_URL = "https://devpad.tools"
FRONTEND_URL = "https://devpad.tools"

[[d1_databases]]
binding = "DB"
database_name = "devpad-unified-db"
database_id = "PLACEHOLDER_DB_ID"

[[r2_buckets]]
binding = "BLOG_CORPUS_BUCKET"
bucket_name = "blog-devpad-corpus"

[[r2_buckets]]
binding = "MEDIA_CORPUS_BUCKET"
bucket_name = "media-timeline-corpus"

[env.preview]
name = "devpad-unified-preview"

[env.preview.vars]
ENVIRONMENT = "preview"
API_URL = "https://preview.devpad.tools"
FRONTEND_URL = "https://preview.devpad.tools"

[[env.preview.d1_databases]]
binding = "DB"
database_name = "devpad-unified-db-preview"
database_id = "PLACEHOLDER_PREVIEW_DB_ID"

[[env.preview.r2_buckets]]
binding = "BLOG_CORPUS_BUCKET"
bucket_name = "blog-devpad-corpus-preview"

[[env.preview.r2_buckets]]
binding = "MEDIA_CORPUS_BUCKET"
bucket_name = "media-timeline-corpus-preview"

# Secrets (set via `wrangler secret put`):
# GITHUB_CLIENT_ID
# GITHUB_CLIENT_SECRET
# JWT_SECRET
# ENCRYPTION_KEY
# REDDIT_CLIENT_ID
# REDDIT_CLIENT_SECRET
# TWITTER_CLIENT_ID
# TWITTER_CLIENT_SECRET
#
# For preview: `wrangler secret put <NAME> --env preview`
