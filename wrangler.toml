name = "devpad-unified"
main = "dist/_worker.js"
compatibility_date = "2024-12-01"
compatibility_flags = ["nodejs_compat"]
routes = [
  { pattern = "devpad.tools", custom_domain = true },
  { pattern = "blog.devpad.tools", custom_domain = true },
  { pattern = "media.devpad.tools", custom_domain = true },
]

[assets]
directory = "dist"

[triggers]
crons = ["*/5 * * * *"]

[observability]
enabled = true

[observability.logs]
invocation_logs = true

[vars]
ENVIRONMENT = "production"
API_URL = "https://devpad.tools"
FRONTEND_URL = "https://devpad.tools"

[[d1_databases]]
binding = "DB"
database_name = "devpad-unified-db"
database_id = "43bc9f1b-70a9-4844-b3c6-9c95e14bacbf"
migrations_dir = "packages/schema/src/database/drizzle"

[[r2_buckets]]
binding = "BLOG_CORPUS_BUCKET"
bucket_name = "devpad-corpus"

[[r2_buckets]]
binding = "MEDIA_CORPUS_BUCKET"
bucket_name = "devpad-corpus"

[env.preview]
name = "devpad-unified-preview"
routes = [
  { pattern = "staging.devpad.tools", custom_domain = true },
  { pattern = "blog.staging.devpad.tools", custom_domain = true },
  { pattern = "media.staging.devpad.tools", custom_domain = true },
]

[env.preview.vars]
ENVIRONMENT = "preview"
API_URL = "https://staging.devpad.tools"
FRONTEND_URL = "https://staging.devpad.tools"

[[env.preview.d1_databases]]
binding = "DB"
database_name = "devpad-unified-db-preview"
database_id = "e162775e-2c68-40ac-8ef4-446fd30ba24c"
migrations_dir = "packages/schema/src/database/drizzle"

[[env.preview.r2_buckets]]
binding = "BLOG_CORPUS_BUCKET"
bucket_name = "devpad-corpus-staging"

[[env.preview.r2_buckets]]
binding = "MEDIA_CORPUS_BUCKET"
bucket_name = "devpad-corpus-staging"

[env.preview.observability]
enabled = true

[env.preview.observability.logs]
invocation_logs = true

# Secrets for preview (set via `wrangler secret put <NAME> --env preview`):
# GITHUB_CLIENT_ID
# GITHUB_CLIENT_SECRET
# JWT_SECRET
# ENCRYPTION_KEY
# REDDIT_CLIENT_ID
# REDDIT_CLIENT_SECRET
# TWITTER_CLIENT_ID
# TWITTER_CLIENT_SECRET
